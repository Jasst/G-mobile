<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Поиск адресов Bitcoin</title>
  <style>
    /* Темная тема */
    body {
      margin: 0;
      padding: 20px;
      background: #121212;
      color: #e0e0e0;
      font-family: Arial, sans-serif;
    }
    input, select, button {
      background: #1e1e1e;
      color: #e0e0e0;
      border: 1px solid #333;
      padding: 8px;
      border-radius: 4px;
      margin: 4px 0;
    }
    button {
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    button:hover {
      background: #333;
    }
    button:active {
      transform: scale(0.98);
    }
    label {
      display: block;
      margin-top: 10px;
    }
    /* Статусы */
    #status {
      margin-top: 10px;
      font-weight: bold;
    }
    #counter {
      margin-top: 5px;
    }
    /* Прогресс по воркерам */
    #progressBars {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      margin-top: 20px;
    }
    .worker-block {
      background: #1e1e1e;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }
    .worker-title {
      font-size: 0.9rem;
      margin-bottom: 6px;
    }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #333;
      border-radius: 4px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #ff8a00, #e52e71);
      border-radius: 4px;
      transition: width 0.3s ease-in-out;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    /* Лог */
    #log {
      height: 250px;
      overflow-y: auto;
      background: #1e1e1e;
      padding: 10px;
      margin-top: 20px;
      border-radius: 6px;
      font-size: 0.9rem;
    }
    #log .found {
      color: #00e676;
      font-weight: bold;
      animation: highlight 1s ease;
    }
    @keyframes highlight {
      0% { background: rgba(0,230,118,0.2); }
      100% { background: transparent; }
    }
  </style>
</head>
<body>
  <div>
    <label>Начальный HEX: <input id="startHex" placeholder="e.g. 1A2B..." /></label>
    <label>Конечный HEX: <input id="endHex" placeholder="e.g. FF.." /></label>
    <label>Префикс адреса: <input id="prefix" placeholder="e.g. 1A" /></label>
    <label>Полный адрес: <input id="fullAddress" placeholder="e.g. 1A1zP..." /></label>
    <label>Воркеров: <input id="workerCount" type="number" value="4" min="1" max="16"/></label>
    <button id="toggleBtn">Начать</button>
    <button id="resetBtn">Сброс</button>
    <button id="downloadLogBtn">Скачать лог</button>
  </div>
  <div id="status">Готов</div>
  <div id="counter">Проверено: 0</div>
  <div id="progressBars"></div>
  <div id="log"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const startHex = document.getElementById('startHex');
      const endHex = document.getElementById('endHex');
      const prefix = document.getElementById('prefix');
      const fullAddr = document.getElementById('fullAddress');
      const wCount = document.getElementById('workerCount');
      const btnToggle = document.getElementById('toggleBtn');
      const btnReset = document.getElementById('resetBtn');
      const btnDL = document.getElementById('downloadLogBtn');
      const statusEl = document.getElementById('status');
      const counterEl = document.getElementById('counter');
      const barsEl = document.getElementById('progressBars');
      const logEl = document.getElementById('log');

      let workers = [];
      let running = false;
      let checked = 0;
      let totalWorkers = 4;
      let doneFlags = [];

      function updateFill(text, isFound = false) {
        const el = document.createElement('div');
        el.textContent = text;
        if (isFound) el.classList.add('found');
        logEl.appendChild(el);
        logEl.scrollTop = logEl.scrollHeight;
      }

      function createBars(n) {
        barsEl.innerHTML = '';
        doneFlags = Array(n).fill(false);
        for (let i = 0; i < n; i++) {
          const block = document.createElement('div');
          block.className = 'worker-block';
          block.innerHTML = `
            <div class="worker-title">Worker ${i}</div>
            <div class="progress-bar"><div id="fill_${i}" class="progress-fill"></div></div>
          `;
          barsEl.appendChild(block);
        }
      }

      function resetAll() {
        workers.forEach(w => w.terminate());
        workers = []; running = false; checked = 0;
        counterEl.textContent = 'Проверено: 0';
        statusEl.textContent = 'Готов';
        barsEl.innerHTML = '';
        logEl.innerHTML = '';
        btnToggle.textContent = 'Начать';
      }

      function updateBar(id, percent) {
        const fill = document.getElementById(`fill_${id}`);
        if (fill) fill.style.width = percent + '%';
      }

      function startSearch() {
        if (running) return;
        if (!/^[0-9A-Fa-f]{1,64}$/.test(startHex.value) || !/^[0-9A-Fa-f]{1,64}$/.test(endHex.value)) {
          alert('HEX должен быть 1–64 символов 0–9, A–F'); return;
        }
        if (!prefix.value && !fullAddr.value) { alert('Укажи префикс или полный адрес'); return; }
        totalWorkers = Math.min(Math.max(+wCount.value || 1, 1), 16);
        resetAll(); createBars(totalWorkers);

        const bStart = BigInt('0x' + startHex.value.padStart(64, '0'));
        const bEnd = BigInt('0x' + endHex.value.padStart(64, '0'));
        const range = bEnd - bStart + 1n;
        const size = range / BigInt(totalWorkers);

        running = true; statusEl.textContent = 'Поиск...'; btnToggle.textContent = 'Пауза';

        workers = [];
        for (let i = 0; i < totalWorkers; i++) {
          const worker = new Worker('worker.js');
          const start = (bStart + size * BigInt(i)).toString();
          const end = (i === totalWorkers - 1) ? bEnd.toString() : (BigInt(start) + size - 1n).toString();
          worker.postMessage({ id: i, start, end, prefix: prefix.value, fullAddress: fullAddr.value });
          worker.onmessage = e => {
            const msg = e.data;
            if (msg.type === 'progress') {
              checked += msg.checkedCount;
              counterEl.textContent = `Проверено: ${checked}`;
              updateBar(msg.id, msg.progress);
            } else if (msg.type === 'found') {
              updateFill(`Worker ${msg.id}: найден ключ ${msg.key}, адрес ${msg.address}`, true);
            } else if (msg.type === 'done') {
              doneFlags[msg.id] = true;
              updateFill(`Worker ${msg.id} завершил`, false);
              if (doneFlags.every(f => f)) {
                running = false;
                statusEl.textContent = 'Готов';
                btnToggle.textContent = 'Начать';
              }
            }
          };
          workers.push(worker);
        }
      }

      btnToggle.addEventListener('click', () => running ? resetAll() : startSearch());
      btnReset.addEventListener('click', resetAll);
      btnDL.addEventListener('click', () => {
        const blob = new Blob([logEl.textContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'log.txt'; a.click(); URL.revokeObjectURL(url);
      });
    });
  </script>
</body>
</html>
